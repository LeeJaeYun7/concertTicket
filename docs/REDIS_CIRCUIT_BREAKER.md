

# 'Redis 서킷 브레이커'  도입 보고서 

## 개요

이 보고서는 크게 4가지 파트로 구성됩니다.

<br> 
  
**1) 서킷 브레이커란?** <br>
**2) 서킷 브레이커의 3가지 상태** <br>
**3) 서킷 브레이커의 상태 변경** <br>
**4) Redis 서킷 브레이커 도입** <br> 


<br> 


### 1) 서킷 브레이커란? 

- 서킷 브레이커란, 직역하면 **회로 차단기**로 서비스간 장애 전파를 막는 역할을 하는 것입니다. <br>
  서킷 브레이커는 문제가 발생했을 때, **Open State**로 변경하여 요청을 차단함으로써 장애 전파를 막습니다. <br>

  이를 그림으로 나타내면 다음과 같습니다. <br> 
![image](https://github.com/user-attachments/assets/f0dd10af-ca83-4bce-8537-467f2dd43a67)


<br>


### 2) 서킷 브레이커의 3가지 상태 

- 서킷 브레이커에는 3가지 상태가 있는데, 바로 **Closed, Open, Half Open**입니다. <br>
  이를 표로 나타내면 다음과 같습니다. <br>

<br> 


| 상태         | Closed                                       | Open                                    | Half Open                                |
|--------------|----------------------------------------------|-----------------------------------------|------------------------------------------|
| 상황         | 정상                                         | 장애                                    | Open 상태가 되고 일정 요청 횟수/시간이 지난 상황. |
| 요청에 대한 처리 | 요청에 대한 처리 수행, 정해진 횟수/비율만큼 실패할 경우 Open 상태로 변경 | 외부 요청을 차단하고 에러를 뱉거나 지정한 callback 메소드를 호출 | 요청에 대한 처리를 수행하고 실패시 Open 상태로, 성공시 Close 상태로 변경 |


- 서킷 브레이커에서 **장애로 판단하는 기준**은 크게 2가지가 있습니다. <br>

(1) **Slow call** : 기준보다 오래 걸린 요청 <br> 
(2) **Failure call** : 실패 혹은 오류 응답을 받은 요청 <br> 
  

<br> 


### 3) 서킷 브레이커의 상태 변경  
![image](https://github.com/user-attachments/assets/f260ae6e-5944-4132-9066-616a51eb4973)

- 서킷 브레이커의 상태 변경을 순서대로 나타내면 다음과 같습니다. <br>

(1) **Closed 상태에서 정상 요청 수행**

- 시스템은 기본적으로 요청을 정상적으로 처리합니다.
- 이 때는 실패율(failure rate)이나 지연율(slow call rate)이 임계치를 초과하지 않으면 요청을 계속해서 처리합니다.

(2) **실패 임계치 도달 시 Open 상태로 전이**

- 시스템의 실패율(failure rate)이나 지연율(slow call rate)이 설정된 **임계치**(failureRateThreshold, slowCallRateThreshold)를 초과하면 <br>
  시스템은 Closed 상태에서 Open 상태로 전환됩니다. <br> 

(3) **Open 상태에서 일정 시간 경과 후 Half Open 상태로 전이**

- Open 상태에서 일정 시간이 지나면 대기 시간(waitDurationInOpenState)이 경과하여 시스템이 Half Open 상태로 전환됩니다. <br>
  이 상태에서는 시스템이 일부 요청을 허용하여 서비스 상태를 점검합니다.

(4) **Half Open 상태에서 요청 수행**  

- Half Open 상태에서는 시스템이 특정 횟수(permittedNumberOfCallsInHalfOpenState) 만큼 요청을 받아들이고, 그 결과에 따라 다음 상태로 전이됩니다.
  a. **성공 시 Closed 상태로 전환**
- 만약 지정된 횟수만큼의 요청을 성공적으로 처리하면 Half Open 상태에서 다시 Closed 상태로 돌아가 정상적으로 요청을 처리합니다.
  b. **실패 시 Open 상태로 전환**
- 지정된 횟수만큼의 요청을 처리한 후 여전히 실패율이 높은 경우, 시스템은 Half Open 상태에서 다시 Open 상태로 전환되어 요청을 차단합니다.





### 4) Redis 서킷 브레이커 도입 







